@page "/compte"
@using BlazorAutoPulse.ViewModel
@inject NavigationManager Navigation
@inject CompteViewModel VM
@inject ConnexionViewModel ConnexionVM

<PageTitle>Mon Compte - AutoPulse</PageTitle>

<div class="compte-container">
    <!-- Section haute - Profil et informations -->
    <div class="profile-header">
        <div class="profile-left">
            <div class="profile-photo-wrapper">
                <img src="@VM.imageSource" alt="Photo de Profil" class="profile-photo" />

                <label for="photoProfil" class="photo-upload-overlay">
                    <div class="upload-icon">üì∏</div>
                    <p class="upload-text">Cliquez pour @(string.IsNullOrEmpty(VM.imageSource) ? "ajouter" : "modifier")</p>
                    <p class="upload-hint">JPG, PNG</p>
                </label>
                <InputFile id="photoProfil" OnChange="@VM.UpdateProfileImage" style="display:none"/>
            </div>
        </div>

        <div class="profile-info">
            @if (!VM.isEditing)
            {
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Nom</span>
                        <span class="info-value">@VM.compte.Nom</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pr√©nom</span>
                        <span class="info-value">@VM.compte.Prenom</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Date de naissance</span>
                        <span class="info-value">@VM.compte.DateNaissance.ToString("dd/MM/yyyy")</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pseudo</span>
                        <span class="info-value">@VM.compte.Pseudo</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email</span>
                        <span class="info-value">@VM.compte.Email</span>
                    </div>
                </div>
            }
            else
            {
                <div class="info-grid">
                    <div class="info-item">
                        <label class="info-label">Nom</label>
                        <input type="text" @bind="VM.compteEdit.Nom" class="info-input" />
                    </div>
                    <div class="info-item">
                        <label class="info-label">Pr√©nom</label>
                        <input type="text" @bind="VM.compteEdit.Prenom" class="info-input" />
                    </div>
                    <div class="info-item">
                        <label class="info-label">Date de naissance</label>
                        <input type="date" @bind="VM.compteEdit.DateNaissance" class="info-input" />
                    </div>
                    <div class="info-item">
                        <label class="info-label">Pseudo</label>
                        <input type="text" @bind="VM.compteEdit.Pseudo" class="info-input" />
                    </div>
                    <div class="info-item">
                        <label class="info-label">Email</label>
                        <input type="email" @bind="VM.compteEdit.Email" class="info-input" />
                    </div>
                </div>
            }

            <div class="profile-actions">
                @if (!VM.isEditing)
                {
                    <button class="btn-primary" @onclick="VM.ToggleEdit">Modifier le profil</button>
                }
                else
                {
                    <button class="btn-primary" @onclick="VM.SaveProfile">Enregistrer</button>
                    <button class="btn-secondary" @onclick="VM.CancelEdit">Annuler</button>
                }

                <button class="btn-danger" @onclick="ConnexionVM.DeconnexionUtilisateur">D√©connexion</button>
            </div>
        </div>
    </div>

    <!-- Section basse - Navigation et contenu -->
    <div class="account-content">
        <nav class="account-navbar">
            <button class="nav-item @(VM.activeSection == "annonces" ? "active" : "")"
                    @onclick="@(() => VM.SetActiveSection("annonces"))">
                Annonces
            </button>
            <button class="nav-item @(VM.activeSection == "avis" ? "active" : "")"
                    @onclick="@(() => VM.SetActiveSection("avis"))">
                Avis
            </button>
            <button class="nav-item @(VM.activeSection == "adresses" ? "active" : "")"
                    @onclick="@(() => VM.SetActiveSection("adresses"))">
                Adresses
            </button>
            <button class="nav-item @(VM.activeSection == "favoris" ? "active" : "")"
                    @onclick="@(() => VM.SetActiveSection("favoris"))">
                Favoris
            </button>
            <button class="nav-item @(VM.activeSection == "commandes" ? "active" : "")"
                    @onclick="@(() => VM.SetActiveSection("commandes"))">
                Commandes
            </button>
        </nav>

        <div class="content-section">
            <!-- Ici seront inject√©s les diff√©rents composants selon la section active -->
            <div class="section-placeholder">
                <h3>Section: @VM.activeSection</h3>
                <p>Le contenu du composant @VM.activeSection sera affich√© ici.</p>
            </div>
        </div>
    </div>
</div>

@code {

    protected override async Task OnInitializedAsync()
    {
        ConnexionVM.SetNavigation(Navigation);
        await VM.InitializeAsync(StateHasChanged, Navigation);
    }
}