@page "/favoris"
@using BlazorAutoPulse.ViewModel
@inject NavigationManager Navigation
@inject CompteViewModel VM
@inject FavorisViewModel FavorisVM

<PageTitle>Mes Favoris - AutoPulse</PageTitle>

@if (isLoading)
{
    <div class="loading-container">
        <div class="loader"></div>
        <p>Chargement de vos favoris...</p>
    </div>
}
else if (!FavorisVM.AnnoncesFavoris.Any())
{
    <div class="no-favoris">
        <div class="empty-icon">üíî</div>
        <h2>Aucun favori</h2>
        <p>Vous n'avez pas encore ajout√© d'annonces √† vos favoris.</p>
        <p class="hint">Cliquez sur le c≈ìur ü§ç sur une annonce pour l'ajouter √† vos favoris !</p>
        <a href="/" class="btn-primary">Parcourir les annonces</a>
    </div>
}
else
{
    <div class="favoris-header">
        <h1>Mes Favoris</h1>
        <p class="favoris-count">@FavorisVM.AnnoncesFavoris.Count annonce@(FavorisVM.AnnoncesFavoris.Count > 1 ? "s" : "")</p>
    </div>

    <div class="favoris-container">
        @foreach (var a in FavorisVM.AnnoncesFavoris)
        {
            <AnnonceComposant Annonce="@a" />
        }
    </div>
}

@code {
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await VM.InitializeAsync(StateHasChanged, Navigation);
            await FavorisVM.InitializeAsync(StateHasChanged, Navigation);
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }
}