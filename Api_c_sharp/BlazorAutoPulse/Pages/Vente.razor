@page "/vente"
@using BlazorAutoPulse.ViewModel
@inject VenteViewModel VM
@inject GetAllViewModel VMAll
@inject NavigationManager nav

<PageTitle>AutoPulse</PageTitle>

<div id="sell" class="page active">
    <div class="sell-container">
        <h2 class="section-title">Vendez Votre Voiture</h2>
        <div class="sell-form">
            <form>
                <h3 style="margin-bottom: 30px; color: #00d4ff;">Informations du v√©hicule</h3>
                
                <div class="form-group">
                    <label>Titre</label>
                    <input type="text" placeholder="Titre de votre annonce" @bind="VM.annonce.Libelle" required/>
                </div>

                <div class="form-group">
                    <label>Photos du v√©hicule (la premi√®re sera la photo de couverture)</label>
                    <label for="vehiclePhotos" class="file-upload" style="cursor: pointer; display: block; border: 2px dashed #ccc; padding: 20px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üì∏</div>
                        <p style="color: #aaa;">Cliquez pour ajouter des photos</p>
                        <p style="color: #666; font-size: 14px; margin-top: 10px;">JPG, PNG - Max 10 photos</p>
                    </label>
                    <InputFile id="vehiclePhotos" OnChange="@VM.UploadImage" multiple style="display:none"/>
                </div>


                @if (VM.nomPhotos?.Any() == true)
                {
                    <ul class="photos-list">
                        @foreach (var nom in VM.nomPhotos)
                        {
                            <li>@nom</li>
                        }
                    </ul>
                }

                <div class="form-row">
                    <div class="form-group">
                        <label>Marque</label>
                        <select @onchange="VM.OnMarqueChanged">
                            <option value="0" disabled>Toutes les marques</option>
                            @if (VMAll.allMarques != null)
                            {
                                @foreach (var marque in VMAll.allMarques)
                                {
                                    <option value="@marque.IdMarque">@marque.LibelleMarque</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mod√®le</label>
                        <select @onchange="VM.OnModeleChanged">
                            <option value="0" disabled>Tout les mod√®les</option>
                            @if (VMAll.allModeles != null)
                            {
                                @foreach (var modele in VMAll.allModeles)
                                {
                                    <option value="@modele.IdModele">@modele.LibelleModele</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ann√©e</label>
                        <input type="number" placeholder="2021" required @bind="VM.voiture.Annee">
                    </div>
                    <div class="form-group">
                        <label>Kilom√©trage</label>
                        <input type="number" placeholder="45000" required @bind="VM.voiture.Kilometrage">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Carburant</label>
                        <select @onchange="VM.OnCarburantChange">
                            <option value="0" disabled>Tout les carburants</option>
                            @if (VMAll.allCarburants != null)
                            {
                                @foreach (var carburant in VMAll.allCarburants)
                                {
                                    <option value="@carburant.IdCarburant">@carburant.LibelleCarburant</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Motricit√©</label>
                        <select @onchange="VM.OnMotriciteChange">
                            <option value="0" disabled>Toutes les motricit√©</option>
                            @if (VMAll.allMotricite != null)
                            {
                                @foreach (var motricite in VMAll.allMotricite)
                                {
                                    <option value="@motricite.IdMotricite">@motricite.LibelleMotricite</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Puissance</label>
                        <input type="number" placeholder="170" @bind="VM.voiture.Puissance" required>
                    </div>
                    <div class="form-group">
                        <label>Couple</label>
                        <input type="number" placeholder="122" @bind="VM.voiture.Couple" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre de cylindre</label>
                        <input type="number" placeholder="170" @bind="VM.voiture.NbCylindres" disabled="@(VM.voiture.IdCarburant == 4)" required>
                    </div>
                    <div class="form-group">
                        <label>Date de mise en circulation</label>
                        <input type="date" placeholder="2000-01-01" @bind="VM.voiture.MiseEnCirculation" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Boite de vitesse</label>
                        <select @onchange="VM.OnBoiteDeVitesseChange" disabled="@(VM.voiture.IdCarburant == 4)">
                            @if (VM.voiture.IdCarburant == 4)
                            {
                                <option value="2">Automatique</option>
                            }
                            else
                            {
                                <option value="0" disabled>Toutes les bo√Æte de vitesse</option>
                            
                                @if (VMAll.allBoiteDeVitesse != null)
                                {
                                    @foreach (var boite in VMAll.allBoiteDeVitesse)
                                    {
                                        <option value="@boite.IdBoiteDeVitesse">@boite.LibelleBoite</option>
                                    }
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Cat√©gorie de ma voiture</label>
                        <select @onchange="VM.OnCategorieChange">
                            <option value="0" disabled>Toutes les cat√©gorie</option>
                            @if (VMAll.allBoiteDeVitesse != null)
                            {
                                @foreach (var categorie in VMAll.allCategories)
                                {
                                    <option value="@categorie.IdCategorie">@categorie.LibelleCategorie</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Prix souhait√© (‚Ç¨)</label>
                        <input type="number" placeholder="25000" @bind="VM.annonce.Prix" required>
                        <button type="button" class="btn-ia" onclick="alert('Estimation IA : Bas√© sur les informations fournies, un prix juste se situerait entre 29 500 ‚Ç¨ et 31 000 ‚Ç¨.')">‚ú® Estimer le prix par l'IA</button>
                    </div>
                    <div class="form-group">
                        <label>Couleur</label>
                        <select @onchange="VM.OnCouleurChange">
                            <option value="0" disabled>Toutes les couleur</option>
                            @if (VMAll.AllCouleurs != null)
                            {
                                @foreach (var couleur in VMAll.AllCouleurs)
                                {
                                    <option value="@couleur.IdCouleur">@couleur.LibelleCouleur</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nom de l'adresse</label>
                    <input type="text" placeholder="123 rue de l'Exemple" @bind="VM.adresse.Nom" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Num√©ro de rue</label>
                        <input type="number" placeholder="12" @bind="VM.adresse.Numero" required>
                    </div>
                    <div class="form-group">
                        <label>Rue</label>
                        <input type="text" placeholder="Rue de l'exemple" @bind="VM.adresse.Rue" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Code postal</label>
                        <input type="text" placeholder="73000" @bind="VM.adresse.CodePostal" required>
                    </div>
                    <div class="form-group">
                        <label>Ville</label>
                        <input type="text" placeholder="Chamb√©ry" @bind="VM.adresse.LibelleVille" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea placeholder="D√©crivez votre v√©hicule, son √©tat, ses √©quipements..." required></textarea>
                </div>

                <button @onclick="@VM.CreateAnnonce" type="button" class="btn-submit" style="margin-top: 20px;">Publier mon annonce</button>
            </form>
        </div>
    </div>
</div>


@code {
    protected override async Task OnInitializedAsync()
    {
        await VM.InitializeAsync(StateHasChanged, nav);
        await VMAll.InitializeAsync();
    }
}