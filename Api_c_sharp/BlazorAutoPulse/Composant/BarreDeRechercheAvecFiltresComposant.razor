@using BlazorAutoPulse.ViewModel

<div class="search-bar">
    <!-- Marque -->
    <select value="@VM.SelectedMarque" @onchange="VM.OnMarqueChanged">
        <option value="0">Toutes les marques</option>
        @if (VM.AllMarques != null)
        {
            @foreach (var marque in VM.AllMarques)
            {
                <option value="@marque.IdMarque">@marque.LibelleMarque</option>
            }
        }
    </select>

    <!-- Modèle -->
    <select value="@VM.SelectedModele" @onchange="e => { VM.SelectedModele = e.Value?.ToString() ?? string.Empty; }">
        <option value="">Tous les modèles</option>
        @if (VM.FilteredModeles != null)
        {
            @foreach (var modele in VM.FilteredModeles)
            {
                <option value="@modele.IdModele">@modele.LibelleModele</option>
            }
        }
    </select>

    <!-- Carburant -->
    <select value="@VM.SelectedCarburant" @onchange="e => { VM.SelectedCarburant = e.Value?.ToString() ?? string.Empty; }">
        <option value="0">Tous les carburants</option>
        @if (VM.AllCarburants != null)
        {
            @foreach (var carburant in VM.AllCarburants)
            {
                <option value="@carburant.IdCarburant">@carburant.LibelleCarburant</option>
            }
        }
    </select>

    <!-- Catégorie -->
    <select value="@VM.SelectedCategorie" @onchange="e => { VM.SelectedCategorie = e.Value?.ToString() ?? string.Empty; }">
        <option value="0">Toutes les catégories</option>
        @if (VM.AllCategories != null)
        {
            @foreach (var categorie in VM.AllCategories)
            {
                <option value="@categorie.IdCategorie">@categorie.LibelleCategorie</option>
            }
        }
    </select>

    <!-- Filtres avancés -->
    <div class="advanced-filters">
        <div class="filter-row">
            <div class="filter-group">
                <label>Nom</label>
                <input type="text" @bind="VM.Nom" placeholder="Recherche par nom...">
            </div>

            <div class="filter-group">
                <label>Prix min</label>
                <input type="number" @bind="VM.PrixMin" placeholder="Min">
            </div>

            <div class="filter-group">
                <label>Prix max</label>
                <input type="number" @bind="VM.PrixMax" placeholder="Max">
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-group">
                <label>Km min</label>
                <input type="number" @bind="VM.KmMin" placeholder="Min">
            </div>

            <div class="filter-group">
                <label>Km max</label>
                <input type="number" @bind="VM.KmMax" placeholder="Max">
            </div>

            <div class="filter-group">
                <label>Département</label>
                <input type="text" @bind="VM.Departement" placeholder="Ex: 73">
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <button @onclick="VM.EffectuerRecherche" class="btn-primary">🔍 Rechercher</button>
        <button @onclick="VM.ReinitialiserFiltres" class="btn-secondary">🔄 Réinitialiser</button>
    </div>
</div>

@if (VM.HasActiveFilters())
{
    <div class="active-filters">
        <span>Filtres actifs :</span>
        @if (VM.SelectedMarque != "0")
        {
            <span class="filter-tag">Marque: @VM.GetMarqueLibelle(VM.SelectedMarque)</span>
        }
        @if (!string.IsNullOrEmpty(VM.SelectedModele))
        {
            <span class="filter-tag">Modèle: @VM.GetModeleLibelle(VM.SelectedModele)</span>
        }
        @if (VM.SelectedCarburant != "0")
        {
            <span class="filter-tag">Carburant: @VM.GetCarburantLibelle(VM.SelectedCarburant)</span>
        }
        @if (VM.SelectedCategorie != "0")
        {
            <span class="filter-tag">Catégorie: @VM.GetCategorieLibelle(VM.SelectedCategorie)</span>
        }
        @if (!string.IsNullOrEmpty(VM.PrixMin))
        {
            <span class="filter-tag">Prix min: @VM.PrixMin €</span>
        }
        @if (!string.IsNullOrEmpty(VM.PrixMax))
        {
            <span class="filter-tag">Prix max: @VM.PrixMax €</span>
        }
        @if (!string.IsNullOrEmpty(VM.KmMin))
        {
            <span class="filter-tag">Km min: @VM.KmMin</span>
        }
        @if (!string.IsNullOrEmpty(VM.KmMax))
        {
            <span class="filter-tag">Km max: @VM.KmMax</span>
        }
        @if (!string.IsNullOrEmpty(VM.Nom))
        {
            <span class="filter-tag">Nom: @VM.Nom</span>
        }
        @if (!string.IsNullOrEmpty(VM.Departement))
        {
            <span class="filter-tag">Département: @VM.Departement</span>
        }
    </div>
}

@code {
    [Parameter]
    public required RechercheViewModel VM { get; set; }
}